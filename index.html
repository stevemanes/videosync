<!DOCTYPE html>
<html>
<head>
    <title>HTML5 Responsive Video Player with Synchronized Annotations</title>
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <style type="text/css">
        .container-fluid {
            /*padding: 5px !important;*/
        }
        .jumbotron {
            padding: 5px !important;
            margin-bottom: 0;
        }
        .videoControls {
            width: 100%;
            font-size: 20px;
        }

        .videoControls span, .videoControls div {
            display: inline-block;
            color: #999;
        }

        .glyphicon:hover {
            color: #555;
        }

        .blackboard-container {
            min-height: 100%;
            margin: 0 auto;
            padding: 0px 12px 15px 12px;
        }
        .blackboard {
            background-color: #000;
            color: #fff;
            text-align: left;
            font-size: 1.5em;
        }
        .blackboard a:link, a:visited {
            font-size: 1.5em;
            color: greenyellow;
        }
        .blackboard p {
            margin: 0 0 10px 10px;
            font-size: 1em;
        }
        .player {
            padding-bottom: 0;
        }
    </style>
</head>
<body>
<div class="container-fluid">

    <!-- Nav bar -->
    <div class="navbar navbar-default navbar-fixed-top" role="navigation">
        <div class="container">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="#">VideoAnnotation</a>
            </div>
            <div class="navbar-collapse collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li class="active"><a href="#">Home</a></li>
                    <li><a href="#about">About</a></li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Lockers<b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            <li><a href="#">Locker 1</a></li>
                            <li><a href="#">Locker 2</a></li>
                            <li><a href="#">Locker 3</a></li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Themes<b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            <li class="dropdown-header">Admin & Dashboard</li>
                            <li><a href="#">Admin</a></li>
                        </ul>
                    </li>
                    <li><a href="#">Contact</a></li>
                </ul>
            </div>
        </div>

        <!-- Video starts -->
        <div class="row jumbotron">
            <div id="player" class="player col-sm-12 col-md-6">
                <video id="videoPlayer"
                       controls
                       width="100%"
                       poster="videos/poster.jpg">
                    <source src="videos/BigBuckBunny_512kb.mp4" type="video/mp4">
                    Your browser does not support the video tag.
                </video>
            </div>

            <div class="blackboard-container col-sm-12 col-md-6">
                <div id="blackboard" class="blackboard"></div>
            </div>
        </div>

        <div class="row videoControls">
            <div class="videoTime col-xs-6">
                <span class="elapsedTime"></span>/<span class="videoLength"></span>
            </div>
        </div>
    </div>
</div>

<!-- HTML timed articles -->
<article data-start="0" data-end="5">
    <p>Slow pan down to the forest.</p>
</article>

<article data-start="5" data-end="9">
    <p>Keep panning...</p>
</article>

<article data-start="9" data-end="15">
    <p>John Williams-y orchestra overture begins.</p>
</article>

<article data-start="15" data-end="19">
    <p>Purple bird chirps.</p>
</article>

<article data-start="20" data-end="23">
    <p>*klonk*</p>
    <p>Show the producer credits</p>
</article>

<article data-start="25" data-end="28">
    <p>Here's the movie title</p>
</article>

<article data-start="28" data-end="30">
    <p>Establishment shot on a rabbit hole</p>
</article>

<article data-start="31" data-end="34">
    <p>Get closer...</p>
</article>

<article data-start="34" data-end="40">
    <p>And closer...</p>
</article>

<article data-start="42" data-end="45">
    <p>Whoa, wait! Is that a gorilla?</p>
    <div class="embed-responsive embed-responsive-16by9">
        <iframe class="embed-responsive-item"
                src="https://en.wikipedia.org/wiki/Gorilla"
                style="-webkit-transform:scale(0.5);-moz-transform-scale(0.5);">
        </iframe>
    </div>
</article>

<article data-start="47" data-end="52">
    <p>Nope, just Ralph Kramden in a rabbit suit.</p>
    <div class="embed-responsive embed-responsive-16by9">
        <iframe class="embed-responsive-item"
                src="https://en.wikipedia.org/wiki/The_Honeymooners#/media/File:Gleason_honeymooners_1965.JPG"
                style="-webkit-transform:scale(0.5);-moz-transform-scale(0.5);">
        </iframe>
    </div>
</article>

<article data-start="53" data-end="55">
    <p>No more annotations.  Thanks for watching.</p>
</article>

<article data-start="55" data-end="100">
    <a href="index.html">Watch it again</a>
</article>


<!-- Bootstrap core JavaScript
================================================== -->
<!-- Placed at the end of the document so the pages load faster -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
<script src="js/bootstrap.min.js"></script>

<script>
    $( document ).ready(function() {

        // Force blackboard to be the same height as the player.
        $(window).resize(function() {
            $("#blackboard").height($("#player").height());
        })
        $(window).resize(); // On page load

        // HTML5 video event handlers.
        var videoPlayer = $('#videoPlayer');

        videoPlayer.on('loadedmetadata', function() {
            $('.videoLength').text(Math.round(videoPlayer[0].duration));
        });

        videoPlayer.on('play', function() {
            $(window).resize();
        });

        // Timed article display.
        var timestamps = [];
        var all = 0;
        var now = 0;
        var old = 0;
        var i = 0;
        var currentlyShowing = -1;

        // Hide all articles via CSS
        $('article').hide();

        // Loop over the articles, read the timestamp start and end and store
        // them in an array
        $('article').each(function(o) {
            if ($(this).attr('data-start')) {
                timestamps.push({
                    start : +$(this).attr('data-start'),
                    end : +$(this).attr('data-end'),
                    elm : $(this)
                });
            }
        });

        all = timestamps.length;

        // When the video is playing, round up the time to seconds and call the
        // showsection function continuously.
        $('video').bind('timeupdate', function(event) {
            now = Math.round(videoPlayer[0].currentTime);
            $('.elapsedTime').text(now);
            //now = parseInt(this.currentTime);

            // Throttle function calls to full seconds
            if (now > old){
                showArticle(now);
            }
            old = now;
        });

        // Test whether the current time is within the range of any of the
        // defined timestamps and show the appropriate section by copying it
        // to the blackboard.
        function showArticle(t)
        {
            var show = -1;      // Default: don't update the blackboard.

            // See if we have an active annotation.
            for (i = 0; i < all; i++) {
                if (t >= timestamps[i].start && t <= timestamps[i].end) {
                    show = i;
                    break;
                }
            }

            // We have an active annotation.
            if (show > -1) {
                // Are we already showing it?
                if (currentlyShowing != show) {
                    $('#blackboard').html(timestamps[show].elm.html());
                    currentlyShowing = show;
                }
            }
            else {
                $('#blackboard').html('');
            }
        };
    });
</script>

</body>
</html>